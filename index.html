<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake News Detector</title>
    <!-- Using Inter font for a modern look, but keeping the requested Open Sans fallback styles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
    
    <style>
        /* --- Global Reset & Body Styles (Adopted from original login CSS) --- */
        * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            -ms-box-sizing: border-box;
            -o-box-sizing: border-box;
            box-sizing: border-box;
        }

        html {
            width: 100%;
            height: 100%;
        }

        body {
            width: 100%;
            height: 100%;
            font-family: 'Inter', 'Open Sans', sans-serif;
            color: #fff;
            font-size: 18px;
            text-align: center;
            letter-spacing: 0.5px;
            margin: 0;
            padding: 0;
            display: flex; /* Using flex for robust centering */
            justify-content: center;
            align-items: center;

            /* Dark, stylish background gradient */
            background: #092756;
            background: -webkit-radial-gradient(0% 100%, ellipse cover, rgba(104, 128, 138, .4) 10%, rgba(138, 114, 76, 0) 40%), linear-gradient(to bottom, rgba(57, 173, 219, .25) 0%, rgba(42, 60, 87, .4) 100%), linear-gradient(135deg, #670d10 0%, #092756 100%);
            background: radial-gradient(at 0% 100%, ellipse cover, rgba(104, 128, 138, .4) 10%, rgba(138, 114, 76, 0) 40%), linear-gradient(to bottom, rgba(57, 173, 219, .25) 0%, rgba(42, 60, 87, .4) 100%), linear-gradient(135deg, #670d10 0%, #092756 100%);
        }

        /* --- Main App Container Styles (Replacing fixed position) --- */
        .login {
            width: 90%;
            max-width: 550px; /* Increased max-width for better textarea space */
            padding: 40px;
            background: rgba(0, 0, 0, 0.3); /* Subtle backdrop for the form */
            border-radius: 12px;
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.5);
        }
        
        @media (max-width: 600px) {
            .login {
                padding: 20px;
                width: 95%;
            }
        }

        .login h1 {
            color: #fff;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
        }

        /* --- Input and Textarea Styles --- */
        input[type="text"],
        input[type="password"],
        textarea {
            width: 100%;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.4);
            border: none;
            outline: none;
            padding: 15px;
            font-size: 1.1rem; 
            font-family: 'Inter', sans-serif;
            color: #fff;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: inset 0 -5px 45px rgba(100, 100, 100, 0.2), 0 1px 1px rgba(255, 255, 255, 0.2);
            transition: box-shadow .5s ease, border-color .3s;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        input:focus,
        textarea:focus {
            box-shadow: inset 0 -5px 45px rgba(100, 100, 100, 0.6), 0 1px 1px rgba(255, 255, 255, 0.2);
            border-color: #6eb6de;
        }

        /* --- Button Styles (Simplified and modernized) --- */
        .btn {
            display: block;
            width: 100%;
            padding: 12px 14px;
            margin-top: 10px;
            font-size: 1.1rem;
            line-height: normal;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 700;
        }

        .btn-primary {
            text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
            color: #ffffff;
            background-color: #4a77d4;
            /* Gradient for primary button */
            background-image: linear-gradient(to bottom, #6eb6de, #4a77d4);
            border: 1px solid #3762bc;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .btn-primary:hover {
            filter: brightness(1.1);
            background-position: 0 -15px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 4px 8px rgba(0, 0, 0, 0.6);
        }

        /* --- Results Area Styles --- */
        .results {
            margin-top: 30px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            text-align: center;
            min-height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .results.show {
            opacity: 1;
        }

        .results h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .real-news { color: #5cb85c; } /* Green */
        .spam-news { color: #d9534f; } /* Red */

    </style>
</head>

<body>
    <div class="login">
        <h1>Fake News Detector üì∞</h1>

        <!-- Form with client-side JavaScript handler -->
        <form onsubmit="handlePredict(event)">
            <!-- Textarea for input (Placeholder instead of name="message" for Flask) -->
            <textarea id="newsInput" placeholder="Paste the news article or claim here..." rows="6" required></textarea>
            
            <button type="submit" class="btn btn-primary">
                Predict
            </button>
            
            <!-- Results Container (Initially Hidden) -->
            <div class="results" id="predictionResult">
                <h2 id="resultText">Enter text and click Predict</h2>
            </div>
        </form>
    </div>

    <script>
        // Placeholder for the LLM API key
        const apiKey = "";
        
        // Define the API URL for text generation (grounded generation is useful for fake news detection)
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Function to perform exponential backoff for API retries
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        // If it's a 429 (Too Many Requests) or 5xx error, retry
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`Server error: ${response.status}`);
                        }
                        // Other client errors (4xx) should not be retried
                        return response;
                    }
                    return response; // Successful response
                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("API call failed after max retries.", error);
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    // Do not log retries as errors in the console
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        /**
         * Simulates a prediction by calling the Gemini API to analyze the text.
         * The model will classify the text as "Real News" or "Spam News" (Fake News).
         */
        async function handlePredict(event) {
            event.preventDefault(); // Stop the form from submitting normally

            const inputElement = document.getElementById('newsInput');
            const resultDiv = document.getElementById('predictionResult');
            const resultText = document.getElementById('resultText');
            const newsContent = inputElement.value.trim();

            if (!newsContent) {
                resultText.textContent = "Please enter some news text to analyze.";
                resultDiv.className = 'results show spam-news';
                return;
            }

            // Show loading state
            resultText.innerHTML = 'Analyzing... <span class="loading-spinner"></span>';
            resultDiv.className = 'results show';
            resultText.style.color = '#fff';

            // Define the system instruction for the LLM
            const systemPrompt = "You are a highly objective and expert news verification system. Analyze the provided text for evidence of sensationalism, lack of credible sources, emotional language, and typical fake news patterns. Based on your analysis and access to real-time information, classify the text as either 'REAL' or 'SPAM'. Your entire output MUST be only one of these two words: REAL or SPAM. Do not add any other text, explanation, or punctuation.";
            
            // Define the user query
            const userQuery = `Analyze and classify the following news text: "${newsContent}"`;

            // Construct the payload for the Gemini API call
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                // Use Google Search grounding to check for real-time information
                tools: [{ "google_search": {} }], 
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                // Optional: set temperature low for more deterministic classification
                config: {
                    temperature: 0.1
                }
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];
                let classification = "ERROR"; // Default classification

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    classification = candidate.content.parts[0].text.trim().toUpperCase();
                } else {
                    console.error("Unexpected API response structure:", result);
                }

                // Update UI based on classification
                if (classification === 'REAL') {
                    resultText.innerHTML = '‚úÖ <b>Looking Real News</b>';
                    resultDiv.className = 'results show real-news';
                } else if (classification === 'SPAM') {
                    resultText.innerHTML = 'üõë <b>Looking Spam News</b>';
                    resultDiv.className = 'results show spam-news';
                } else {
                    // Handle API failure or unexpected output
                    resultText.innerHTML = '‚ö†Ô∏è Prediction Failed (Try again)';
                    resultDiv.className = 'results show spam-news';
                }

            } catch (error) {
                console.error("Fetch Error:", error);
                resultText.innerHTML = '‚ùå An API error occurred during analysis.';
                resultDiv.className = 'results show spam-news';
            }
        }
    </script>
</body>
</html>
